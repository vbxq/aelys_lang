needs std.io
needs std.convert
needs std.string

fn count_frequency(data, num_bins: int) {
    let mm = min_max(data)
    let min_val = mm[0]
    let max_val = mm[1]
    let range = max_val - min_val

    let bins = Vec[]
    for i in 0..num_bins {
        bins.push(0)
    }

    for i in 0..data.len() {
        let normalized = convert.to_float(data[i] - min_val) / convert.to_float(range)
        let bin_idx = convert.to_int(normalized * convert.to_float(num_bins - 1))
        if bin_idx >= 0 and bin_idx < num_bins {
            bins[bin_idx] = bins[bin_idx] + 1
        }
    }

    return bins
}

fn min_max(numbers) {
    let mut min_val = numbers[0]
    let mut max_val = numbers[0]
    for i in 1..numbers.len() {
        if numbers[i] < min_val { min_val = numbers[i] }
        if numbers[i] > max_val { max_val = numbers[i] }
    }
    return Array[min_val, max_val]
}

fn max_in_vec(v) -> int {
    let mut m = v[0]
    for i in 1..v.len() {
        if v[i] > m { m = v[i] }
    }
    return m
}

let scores = Array[45, 67, 89, 72, 91, 55, 78, 82, 68, 93,
                   58, 77, 85, 62, 95, 71, 80, 65, 88, 74]

io.print("Test Scores Histogram")
io.print("====================")
io.print("")

let bins = count_frequency(scores, 5)
let max_count = max_in_vec(bins)

let labels = Array["0-20", "20-40", "40-60", "60-80", "80-100"]

for i in 0..bins.len() {
    let count = bins[i]
    let label = labels[i]

    let bar_width = 40
    let ratio = convert.to_float(count) / convert.to_float(max_count)
    let num_stars = convert.to_int(ratio * convert.to_float(bar_width))

    let bar = string.repeat("â–ˆ", num_stars)
    let padded_label = string.pad_right(label, 8, " ")
    let count_str = string.pad_left(convert.to_string(count), 3, " ")

    io.print(padded_label + " " + count_str + " " + bar)
}
