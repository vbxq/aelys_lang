needs std.math
needs std.io
needs std.convert
needs std.time

let WIDTH: int = 80
let HEIGHT: int = 24
let MAX_ITER: int = 100

fn mandelbrot(cr: float, ci: float) -> int {
    let mut zr: float = 0.0
    let mut zi: float = 0.0
    let mut iter: int = 0

    while iter < MAX_ITER {
        let zr2: float = zr * zr
        let zi2: float = zi * zi

        if zr2 + zi2 > 4.0 {
            return iter
        }

        let new_zr = zr2 - zi2 + cr
        zi = 2.0 * zr * zi + ci
        zr = new_zr
        iter = iter + 1
    }
    return 0
}

fn render_frame() {
    let x_min: float = -2.5
    let x_max: float = 1.0
    let y_min: float = -1.0
    let y_max: float = 1.0

    let x_step: float = (x_max - x_min) / WIDTH
    let y_step: float = (y_max - y_min) / HEIGHT

    for y in 0..HEIGHT {
        let ci: float = y_max - y * y_step
        for x in 0..WIDTH {
            let cr: float = x_min + x * x_step
            let iter = mandelbrot(cr, ci)
        }
    }
}

let t = time.timer()
for frame in 0..10 {
    render_frame()
}
let elapsed = time.elapsed_ms(t)

io.print("10 frames rendered")
io.print("time: " + convert.to_string(elapsed) + "ms")
io.print("fps: " + convert.to_string(10000 / elapsed))
